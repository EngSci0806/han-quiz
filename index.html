<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>éŸ“å›½èªæ´»ç”¨ã‚¯ã‚¤ã‚ºï¼ˆÎ±ï¼‰</title>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            margin: 50px;
        }
        input, button {
            font-size: 1.2em;
            padding: 8px;
            margin: 10px;
        }
        #result {
            font-size: 1.2em;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>ğŸ‡°ğŸ‡· éŸ“å›½èª æ´»ç”¨ã‚¯ã‚¤ã‚ºï¼ˆÎ±ï¼‰</h1>
    <p id="question"></p>
    <input type="text" id="answer" placeholder="ç­”ãˆã‚’å…¥åŠ›">
    <p id="result"></p>
    <p id="score"></p>
    <button id="toggleMode">å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ</button>

    <script>
        let quizData = [];
        let remainingQuestions = [];
        let wrongQuestions = [];
        let currentQuiz = {};
        let score = 0;
        let total = 0;
        let answered = false;
        let reviewMode = false;

        function pickQuestion() {
            document.getElementById("result").textContent = "";
            document.getElementById("answer").value = "";
            answered = false;

            let source = reviewMode ? wrongQuestions : remainingQuestions;

            if (source.length === 0) {
                if (reviewMode) {
                    alert("é–“é•ãˆãŸå•é¡Œã¯å…¨éƒ¨æ­£è§£ã—ã¾ã—ãŸï¼é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚Šã¾ã™ã€‚");
                    reviewMode = false;
                    document.getElementById("toggleMode").textContent = "å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ";
                    source = remainingQuestions;
                } else {
                    remainingQuestions = [...quizData];
                    source = remainingQuestions;
                }
            }

            const randomIndex = Math.floor(Math.random() * source.length);
            currentQuiz = source.splice(randomIndex, 1)[0];
            document.getElementById("question").textContent = `ã€Œ${currentQuiz.åŸºæœ¬å½¢}ã€ã®${currentQuiz.å‡ºé¡Œå½¢}ã¯ï¼Ÿ`;
        }

        function checkAnswer() {
            const userAnswer = document.getElementById("answer").value.trim();
            total++;
            if (userAnswer === currentQuiz.ç­”ãˆ) {
                score++;
                if (reviewMode) {
                    wrongQuestions = wrongQuestions.filter(q =>
                        !(q.åŸºæœ¬å½¢ === currentQuiz.åŸºæœ¬å½¢ && q.å‡ºé¡Œå½¢ === currentQuiz.å‡ºé¡Œå½¢)
                    );
                }
                document.getElementById("result").textContent = "âœ… æ­£è§£ï¼";
            } else {
                document.getElementById("result").textContent = `âŒ ä¸æ­£è§£ã€‚æ­£è§£ã¯ã€Œ${currentQuiz.ç­”ãˆ}ã€ã§ã™ã€‚`;
                if (!wrongQuestions.some(q => q.åŸºæœ¬å½¢ === currentQuiz.åŸºæœ¬å½¢ && q.å‡ºé¡Œå½¢ === currentQuiz.å‡ºé¡Œå½¢)) {
                    wrongQuestions.push(currentQuiz);
                }
            }
            document.getElementById("score").textContent = `ã‚¹ã‚³ã‚¢: ${score} / ${total}`;
            answered = true;
        }

        document.getElementById("answer").addEventListener("keydown", function(event) {
            if (event.key === "Enter") {
                if (!answered) {
                    checkAnswer();
                } else {
                    pickQuestion();
                }
            }
        });

        document.getElementById("toggleMode").addEventListener("click", function() {
            reviewMode = !reviewMode;
            this.textContent = reviewMode ? "é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ" : "å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ";
            pickQuestion();
        });

        function loadCSV() {
            Papa.parse("questions.csv", {
                download: true,
                header: true,
                complete: function(results) {
                    // CSVã‚’ã€ŒåŸºæœ¬å½¢ã€ã€Œå‡ºé¡Œå½¢ã€ã€Œç­”ãˆã€ã®å½¢ã«æ•´å½¢
                    results.data.forEach(row => {
                        Object.keys(row).forEach(key => {
                            if (key !== "ç¨®é¡" && key !== "åŸºæœ¬å½¢" && key !== "èªå¹¹" && key !== "ãƒ‘ãƒƒãƒãƒ æœ‰ç„¡") {
                                quizData.push({
                                    åŸºæœ¬å½¢: row["åŸºæœ¬å½¢"],
                                    å‡ºé¡Œå½¢: key,
                                    ç­”ãˆ: row[key]
                                });
                            }
                        });
                    });
                    remainingQuestions = [...quizData];
                    pickQuestion();
                },
                error: function(error) {
                    document.getElementById("question").textContent = "CSVã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
                    console.error("CSVèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", error);
                }
            });
        }

        loadCSV();
    </script>
</body>
</html>
